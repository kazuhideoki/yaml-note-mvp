# ソースコード コメント追加手順書

## 1. 目的

この手順書は、`yaml-note-mvp` プロジェクトのソースコードに適切かつ効果的なコメントを追加するためのガイドラインと手順を定めるものです。コメント追加の主な目的は以下の通りです。

- **コードの可読性向上**: コードの意図、ロジック、設計判断を明確にし、他の開発者（将来の自分自身を含む）が容易に理解できるようにします。
- **保守性の向上**: コードの変更やデバッグを容易にし、副作用のリスクを低減します。
- **開発エージェント（AIアシスタント等）による理解促進**: AIがコードの文脈や機能を正確に把握し、より質の高いサポートを提供できるようにします。
- **知識共有の円滑化**: プロジェクトに関する暗黙知を形式知化し、チーム内での知識共有を促進します。
- **オンボーディングの効率化**: 新しいプロジェクトメンバーが迅速にコードベースを理解し、開発に参加できるよう支援します。

## 2. コメント基本方針

コメントを記述する際は、以下の基本方針に従います。詳細なモジュール別方針については、別途提示された「プロジェクト全体のコメント方針」「モジュール別コメント方針」を参照してください。

- **「なぜ」を説明する**: コードが「何をしているか」よりも「なぜそのように実装されているのか」という背景や設計意図を重視します。
- **APIドキュメンテーションの充実**: 公開インターフェース（関数、クラス、コンポーネントのpropsなど）には、その使用方法、引数、返り値、副作用、エラー条件などを明記します。
    - TypeScript: JSDoc形式 (`/** ... */`)
    - Rust: ドキュメントコメント (`///` または `//!`)
- **簡潔性と正確性**: コメントは簡潔かつ正確に記述し、コードの変更に合わせて常に最新の状態を保ちます。
- **一貫性の維持**: プロジェクト全体でコメントのスタイルや詳細度の一貫性を保ちます。
- **`TODO`/`FIXME`の活用**: 未実装の機能や修正が必要な箇所には `TODO:` や `FIXME:` プレフィックスを使用し、必要に応じてIssue番号や担当者を記載します。

## 3. 全体手順

コメント追加作業は、以下のフェーズで進めます。

### フェーズ1: 準備
1. **コメント方針の再確認**  
    - [x] 本手順書および別途提示された「プロジェクト全体のコメント方針」「モジュール別コメント方針」をチームメンバー全員で確認し、共通認識を持ちます。

2. **対象範囲と優先順位の決定**  
    - [x] コメントを追加するモジュール、ファイル、機能の範囲を決定します。
    - [x] 優先順位を設定します。一般的には以下の順序が推奨されます。
        1. コア機能、WASMバインディング関数
        2. 公開API（Reactコンポーネント、主要な関数・クラス）
        3. 複雑なロジックやアルゴリズムを含む箇所
        4. 状態管理ロジック
        5. その他（ユーティリティ関数、設定ファイルなど）

3. **ツールの準備と確認**  
    - [x] **IDE**: VSCodeなどのIDEで、JSDocやRustドキュメントコメントのシンタックスハイライト、スニペット機能が有効になっていることを確認します。
    - [x] **Rust**: `cargo doc` コマンドが利用可能であることを確認します。
    - [x] **リンター/フォーマッター**: コメントスタイルに関するルールがあれば、設定を確認します。

### フェーズ2: コメント記述

1. **モジュール/ファイルレベルのコメント**  
    - [x] 各主要モジュール（例: `apps/web/src/components/`, `packages/core-wasm/src/`）や重要なファイル（例: `lib.rs`, `main.tsx`）の冒頭に、そのモジュール/ファイルの役割や概要を記述します。
        - Rust: `//!` を使用したモジュールレベルコメント。
        - TypeScript: ファイル先頭のJSDocコメント (`/** @file ... */`)。

2. **公開APIのコメント**  
    - [x] **Rust (`packages/core-wasm/src/`)**
        - [x] `pub` で公開されている関数、構造体、enum、トレイトに `///` 形式でドキュメントコメントを追加します。
        - [x] `#[wasm_bindgen]` でJavaScriptに公開される関数には、引数、返り値、パニック条件、JavaScript側からの利用例などを記述します。
    - [x] **TypeScript (`apps/web/src/`)**
        - [x] Reactコンポーネント: コンポーネントの目的、propsの型と説明、主要なstateについてJSDocで記述します。
        - [x] カスタムフック: フックの目的、引数、返り値についてJSDocで記述します。
        - [x] 公開関数/クラス/メソッド: 目的、引数、返り値、スローする可能性のあるエラーについてJSDocで記述します。
        - [x] 型定義 (`interface`, `type`): 各プロパティの意味や制約についてJSDocで記述します。

3. **複雑なロジックへのコメント**  
    - [ ] 複雑なアルゴリズム、パフォーマンスクリティカルな処理、直感的でない条件分岐など、コードを読むだけでは理解が難しい箇所に、通常のコメント (`//` や `/* ... */`) で説明を追加します。

4. **`TODO`/`FIXME`コメントの整理・追加**  
    - [x] 既存の `TODO`/`FIXME` コメントを見直し、現状に合わせて更新または削除します。
    - [x] 新たに発見された課題や将来的な改善点があれば、適切なプレフィックスを付けてコメントを追加します。

5. **スキーマファイルへのコメント (`packages/schemas/`)**  
    - [x] YAML形式のJSON Schemaファイルに、`#` を用いてスキーマ全体の目的、各プロパティの意味、制約、使用例などを記述します。

### フェーズ3: レビュー

1. **自己レビュー**  
    - [ ] 記述したコメントが正確であるか、意図が明確に伝わるかを確認します。
    - [ ] コメント方針との整合性、誤字脱字がないかを確認します。

2. **ドキュメント生成ツールでの確認 (Rust)**  
    - [ ] `packages/core-wasm` ディレクトリで `cargo doc --open` を実行し、生成されたドキュメントが意図通りに表示されるか確認します。リンク切れやフォーマット崩れがないかチェックします。

3. **ピアレビュー (推奨)**  
    - [ ] 他の開発者にコメントのレビューを依頼します。
    - [ ] レビュアーは、コメントの明瞭性、網羅性、正確性、一貫性を中心に確認します。

### フェーズ4: 統合

1. **バージョン管理システムへのコミット**  
    - [ ] コメント追加・修正作業を適切な粒度でコミットします。コミットメッセージには、コメント作業であることがわかるように記載します (例: `docs: Add JSDoc comments to MyComponent`)。

2. **ドキュメントの共有 (該当する場合)**  
    - [ ] `cargo doc` で生成したドキュメントなど、チーム内で共有すべきドキュメントがあれば、適切な場所に配置・公開します。

### フェーズ5: 継続的改善

1. **コード変更時のコメント更新**  
    - [ ] コードの機能変更やリファクタリングを行った際は、必ず関連するコメントも更新します。古いコメントは混乱の元となります。

2. **定期的な見直し**  
    - [ ] 定期的にコメントの品質を見直し、必要に応じて改善します。
    - [ ] 新しい知見や変更された設計思想をコメントに反映させます。

---

この手順書が、プロジェクトのコード品質向上に役立つことを願っています。作業を進める中で不明な点や改善案があれば、適宜チームで話し合い、本手順書も更新していくことが望ましいです。